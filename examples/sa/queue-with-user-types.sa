type Either<$t1, $t2> = Left<$t1> || Right<$t2>

enum ErrorStatus {
   emptyQueue
}

record Queue<$t> {
    private queue is [$t]

    this(element is $t) -> Queue<$t> {
        this(queue: [element])
    }

    public fn enqueue<$t>(element is $t) -> Queue<$t>  {
        this(queue : queue @ [element])
    }

    public fn null() -> Bool {
        queue.isEmpty()
    }

    public fn hd() -> Either<$t, ErrorStatus> {
        switch queue {
            case [?first :: _] => Left<first>
            case [] => Right<ErrorStatus#emptyQueue>
        }
    }

    public fn dequeue() -> Either<Queue<$t>, ErrorStatus> {
        switch queue {
            case [_ :: ?rest] => Left<this(queue: rest)>
            case [] => Right<ErrorStatus#emptyQueue>
        }
    }
}

export fn main(_args) {
    ?a := new Queue(42),
    ?a := a.enqueue(4711),
    Left<42> := b.hd(),
    ?b := new Queue(42),
    ?b := b.enqueue(4711),
    true := (a =Queue= b)
}
